<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NextDoor Object Detection from a video</title>
    <script src="/static/common/adapter-latest.js"></script>
    <style>
        video#myVideo {
            position: absolute;
            top: 60px;
            width:400px;
            left: 10px;
            z-index: -1;
        }
        canvas{
            position: absolute;
            top: 60px;
            width:400px;
            left: 10px;
            z-index:1
        }
        p#data {
          top: 700px;
          left: 700px;
		  max-height: 15em;
		  overflow-y: auto;
		}
    </style>
</head>
<body>
    <input id="inpVideo" type="text" value="" placeholder="video url"></input>
    <button id="btnVideo" onclick="update(this)">Send</button>
    <button onClick="window.location.reload()">Reload</button>
    <div id="container">
		<video id="myVideo" crossOrigin="anonymous" src="/static/video/007.webm" muted controls></video>
		<p id="data"></p>
    </div>
</body>
    <script>
      'use strict';
      function update(stream) {
        inpV = document.getElementById('inpVideo').value;
        if (inpV == '') {
            alert('Video Url is Null');
        } else {
            document.getElementById('myVideo').src = inpV;
        }
        
      }
      var data = document.querySelector('p#data');

      function plog(message) {
        data.innerHTML = message + '<br><br>' + data.innerHTML;
      }
      

      var chromeVideo = document.getElementById('chrome');
      var containerDiv = document.getElementById('myVideo');
      var video1 = document.getElementById('video1');
      var video2 = document.getElementById('video2');

      function toggleChromeVideo() {
        if (chromeVideo.classList.contains('transparent')) {
          chromeVideo.classList.remove('transparent');
          chromeVideo.play();
        } else {
          chromeVideo.classList.add('transparent');
          chromeVideo.pause();
        }
      }

      chromeVideo.addEventListener('gesturedoubletap', toggleChromeVideo, false);
      containerDiv.addEventListener('gesturedoubletap', toggleChromeVideo, false);

      function addEventListeners(video) {
        video.addEventListener('dblclick', handleDoubleClick, false);
        video.addEventListener('pointerdown', handlePointerDown, false);
        video.addEventListener('pointerup', handlePointerUp, false);
        video.addEventListener('pointermove', handlePointerMove, false);
      }
      addEventListeners(video1);
      addEventListeners(video2);

      function handleDoubleClick(event) {
        var video = event.srcElement;
        video.classList.remove('rotateOut');
        setTimeout(function() {
          video.classList.add('rotateOut');
        }, 5);
        event.preventDefault();
      }

      var isPointerDown = false;

      function handlePointerDown(event) {
        isPointerDown = true;
        var video = event.srcElement;
        video.style.opacity = 0.7;
        video.style.webkitFilter = 'blur(3px) grayscale(1)';
        video.style.zIndex = video.style.zIndex + 1;
        event.preventDefault();
      }

      function handlePointerUp(event) {
        isPointerDown = false;
        var video = event.srcElement;
        video.style.opacity = 2;
        video.style.webkitFilter = 'blur(0px)';
        event.preventDefault();
      }

      function handlePointerMove(event) {
        if (!isPointerDown) {
          return;
        }
        var video = event.srcElement;
        var videoWidth = video.clientWidth;
        var videoHeight = video.clientHeight;

        video.style.left = (event.clientX - videoWidth / 2) + 'px';
        video.style.top = (event.clientY - videoHeight / 2) + 'px';

        event.preventDefault();
      }

    </script>
<script id="objDetect" src="/static/objDetectOnMotion.js" data-source="myVideo"  data-scoreThreshold="0.40"></script>
</html>